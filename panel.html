<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bootcamp</title>
    <link rel="icon" href="image/favicon5.ico">
    <link rel="stylesheet" href="font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- -------------------------------------------------------------------------
    div : یک عنصر بلاک با کاربرد عمومی است که محتوای فلوی صفحه را می توان
         بمنظور تفکیک ، جداسازی و نیز استایل دهی بخش های مختلف در آن قرار داد 
    ------------------------------------------------------------------------------
    container : کلاس تعیین محدوده و عرض صفحات سایت
    --------------------------------------------- -->
    <div class="container">

        <!-- ---------------------------------------
        background : کلاس تعیین پس زمینه صفحات سایت
        ---------------------------------------- --> 
        <div class="background">

            <!-- -------------------------------------------------------------------------
                pg_massenger : محتوای اصلی پنجره صفحه پیام رسانی که خود شامل دو بخش است 
                در این کلاس معرفی شده است 
            -------------------------------------------------------------------------- -->
            <div class="pg_massenger">

                <!-- --------------------------------------------------------
                    section : عنصر معنایی که بخش مستقل عمومی از یک سند را 
                    نشان می دهد که باید همیشه یک عنوان داشته باشند

                    pg_box : کلاس دارای یک استایل خاص با حاشیه های گرد 
                    و پس زمینه آبی که به بخش های مورد نظر اعمال می شود

                    pg_msg_side : استایل و تفکیک بخش حاشیه پنجره پیام رسان 
                    حاوی لیست مخاطبان را معین می کند
                --------------------------------------------------------- -->
                <section class="pg_box pg_msg_side">

                    <!-- ------------------------------------------------------------
                        header_side : عنوان نشاندهنده بخش مخاطبین
                    ------------------------------------------------------------- -->
                    <div class="header_side">
                        
                        <!-- ---------------------------------------------------------------
                            h3 : عنصر نشان دهنده عنوان یک بخش با سطح سه
                            
                            title_side : استایل عنوان بخش حاشیه پنجره پیام رسان

                            padding_box : کلاسی برای تعیین یک پدینگ ثابت برای بخش های مورد نظر
                        --------------------------------------------------------------- -->
                         <h3 class="title_side padding_box">پیام رسان فراوین</h3>

                        <!-- ---------------------------------------------------------------
                            icon_header : کلاسی برای تفکیک و استایل دادن بخش نگهدارنده آیکون های 
                            مورد نیاز 
                        --------------------------------------------------------------- -->
                        <div class="icon_header padding_box">

                            <!-- ------------------------------------------------------------------
                            i.fa : fontawsome تگ تعیین شده برای استفاده از استایل فونت های سایت

                            fa-plus : fontawsome کلاس ایجاد آیکن پلاس از سایت 
                            fa-refresh : fontawsome کلاس ایجاد آیکن رفرش از سایت 
                            ------------------------------------------------------------------- -->
                            <i id="plusIcon" class="fa fa-plus" aria-hidden="true"></i>
                            <i class="fa fa-refresh" aria-hidden="true"></i>
                        </div>
                    </div>

                    <!-- ----------------------------------------------------------
                        list_contact : برای تفکیک و استایل بخش حاوی لیست مخاطبین
                    ----------------------------------------------------------- -->
                    <div class="list_contact">

                        <!-- -----------------------------------------------
                            item_contact : استایل هر مخاطب را تعیین می کند
                        ------------------------------------------------ -->
                        <div class="item_contact padding_box">

                            <!-- -----------------------------------------------------
                                img : این عنصر یک تصویر را در سند جاسازی می کند

                                user_icon : استایل مربوط به آیکن کاربر را تعریف می کند
                            ------------------------------------------------------ -->
                            <img class="user_icon" src="image/user_icon.png" alt="user_icon">
                            علی رضایی
                        </div>


                        <div class="item_contact padding_box">
                            <img class="user_icon" src="image/user_icon.png" alt="user_icon">
                            بابا
                        </div>
                        <div class="item_contact padding_box">
                            <img class="user_icon" src="image/user_icon.png" alt="user_icon">
                            مرضیه
                        </div>

                        <!-- ------------------------------------------------------------------
                            item_active : مخاطبی که انتخاب شده است این کلاس را دریافت می کند
                        ------------------------------------------------------------------- -->
                        <div class="item_contact padding_box item_active">
                            <img class="user_icon" src="image/user_icon.png" alt="user_icon">
                            احمد کریمی
                        </div>


                        <div class="item_contact padding_box">
                            <img class="user_icon" src="image/user_icon.png" alt="user_icon">
                            مدیر مالی شرکت
                        </div>
                        <div class="item_contact padding_box">
                            <img class="user_icon" src="image/user_icon.png" alt="user_icon">
                            رضا حسینی
                        </div>
                        <div class="item_contact padding_box">
                            <img class="user_icon" src="image/user_icon.png" alt="user_icon">
                            بهنام هاشم نیا
                        </div>
                    </div>
                </section> <!-- end of pg_msg_side -->

                <!-- ------------------------------------------------------------------------
                    pg_msg_content : محتوای اصلی پیام های مخاطب انتخاب شده را در برمیگیرد
                ------------------------------------------------------------------------- -->
                <section class="pg_msg_content">

                    <!-- ---------------------------------------------------------------
                        header_contact : تعیین استایل عنوان بخش محتوای پیامهای پنجره پیام رسان
                    ---------------------------------------------------------------- -->
                    <header class="pg_box header_contact padding_box">
                        <div>
                            <img class="user_icon" src="image/user_icon.png" alt="user_icon">
                            <span class="name_contact">احمد کریمی</span>
                        </div>
        
                        <div class="fx_icon_header padding_box">
                            <i id="editIcon" class="fa fa-pencil" aria-hidden="true"></i>
                            <i class="fa fa-refresh" aria-hidden="true"></i>
                        </div>
                    </header>
                    <div class="show_msg">
        
                        <!-- باکس نگهدارنده هر پیام -->
                        <div class="msg_box send padding_box">
                            <div class="send padding_box">
                                <p>
                                    سلام، خوبی؟
                                </p>
                                <span class="time">3 فروردین - 11:38</span>
                            </div>
                        </div>

                        <div class="msg_box send padding_box">
                            <div class="send padding_box">
                                <p>
                                    پروژه رو تا کجا رسوندی؟
                                </p>
                                <span class="time">3 فروردین - 11:39</span>
                            </div>
                        </div>

                        <div class="msg_box receive padding_box">
                            <div class="receive padding_box">
                                <p>
                                    سلام، ممنون.
                                </p>
                                <p>
                                    خوب پیش می رم و آخراشه..
                                </p>
                                <span class="time">4 فروردین - 12:10</span>
                            </div>
                        </div>            
                    </div>

                    <!-- باکس ارسال پیام -->        
                    <div class="pg_box msg_content padding_box">
                        <input type="text" placeholder="پیام ...">
                        <img src="image/send.png" alt="ارسال پیام">
                    </div>
                </section> <!-- end of pg_msg_content -->
    
            </div> <!-- end of pg_massanger -->

        </div> <!-- end of background -->
    </div> <!-- end of container -->

    <!-- ---------------------------------------------------------------
    پاپ آپ افزودن/ویرایش مخاطب 
    popupBox: باکس دریافت اطلاعات و ثبت مخاطب جدید/ویرایش مخاطب موجود
    در حال معمول display: none
    ---------------------------------------------------------------- -->
   <div id="popupBox">
    <div class="box_form popUp">
        <i id="closeIcon" class="fa close" title="close">&#x2715;</i>
        <form action="" method="post">
            <div class="row_input">
                <label for="mobileUser">موبایل :</label>
                <input type="tel" id="mobileUser" maxlength="11" minlength="11" pattern="[09]{2}[0-9]{9}"
                 placeholder="*********09" required>
            </div>
            <div class="row_input">
                <label for="nameUser">نام و نام خانوادگی :</label>
                <input type="text" id="nameUser" minlength="3" required>
            </div>
            <div class="row_input cnter">
                <button id="btnPopup" class="in_btn"  type="button"></button>
                <p class="msg"></p>
            </div>
        </form>
    </div>
   </div>

    <script>
        // آرایه مخاطبین که در سامانه ثبت نام کرده اند
        const registeredList = [
            {mobile: '09155803862',username: 'علی'},
            {mobile: '09391570415',username: 'حسین'},
            {mobile: '09123205004',username: 'احمد'},
            {mobile: '09353649470',username: 'رضا'}    
        ]

        // آرایه لیست مخاطبین ذخیره شده
        const contactlist = [
            {mobile: '09155803862',username: 'علی'},
            {mobile: '09353649470',username: 'رضا'}   
        ]

        const telFormat = /^[0,9]{2}\d{9}/

        // ثابت های نگهدارنده عناصر مورد استفاده
        const plusIcon = document.getElementById('plusIcon')
        const editIcon = document.getElementById('editIcon')
        const closeIcon = document.getElementById('closeIcon')
        const popupBox = document.getElementById('popupBox')
        const popUpClass = document.querySelector('.popUp')
        const btnPopup = document.getElementById('btnPopup')
        const mobileInput = document.getElementById('mobileUser')
        const nameInput = document.getElementById('nameUser')

        // مقداری که می گیرد عملکرد دکمه را تعیین می کند. افزودن یا ویرایش
        let btnType

        // کلیک روی آیکن پلاس
        plusIcon.onclick = e => {
            popupBox.style.display = 'flex'        /* default popupBox -> display none */
            btnType = 'btnPlus'
            btnPopup.textContent = 'افزودن مخاطب'
            btnPopup.nextElementSibling.textContent = ''
        }

        // کلیک روی آیکن ادیت
        editIcon.onclick = e => {
            popupBox.style.display = 'flex'      /* default edituserBox -> display none */
            btnType = 'btnEdit'
            btnPopup.textContent = 'اعمال تغییرات'
            btnPopup.nextElementSibling.textContent = ''
        }

        // کلیک روی آیکن کلوز پاپ آپ
        closeIcon.onclick = e => {
            popupBox.style.display = 'none'
        }

        // کلیک روی دکمه ثبت/ذخیره مخاطب
        btnPopup.addEventListener('click', e => {
            let mobileVal = mobileInput.value
            let val1 = mobileVal.match(telFormat)
            let val2 = nameInput.value
            let findContact = null

            // اگر شماره موبایل معتبر باشد
            if(val1) {
                // جستجوی مخاطب در سامانه
                for (const contact of registeredList) { /* registeredList-example list contacts of samaneh*/
                    if(mobileVal.match(contact.mobile)) {
                        findContact = contact
                        break
                    }
                }
                // وقتی مخاطب در سامانه ثبت نام کرده باشد امکان ذخیره دارد
                if(findContact) {
                    mobileInput.classList.remove('error')
                    nameInput.classList.remove('error') 
                    btnPopup.nextElementSibling.textContent = ''
                    // بررسی می کند یک نام برای مخاطب وارد شده باشد
                    if(val2) {
                        let i = 0
                        // جستجوی مخاطب در لیست مخاطبین کاربر
                        for (const c of contactlist) {
                            if(mobileVal.match(c.mobile)) {
                                if(btnType === 'btnPlus') {
                                    btnPopup.nextElementSibling.textContent = 'این مخاطب قبلا ذخیره شده است!'
                                    findContact = null
                                    break
                                }
                                // ویرایش مخاطبین موجود در لیست
                                findContact.username = val2
                                contactlist.splice(i, 1, findContact)
                                findContact = null
                                console.log(contactlist)
                                break
                            }
                            i+=1
                        }
                        // اگر مخاطب قبلا در لیست مخاطبین کاربر نباشد نال نشده و به لیست اضافه میشود
                        if(findContact) {
                            findContact.username = val2
                            contactlist.push(findContact)
                            popupBox.style.display = 'none'
                            console.log(contactlist)
                        }
                    } else {
                        nameInput.classList.add('error')
                        btnPopup.nextElementSibling.textContent = 'یک نام دلخواه برای مخاطب وارد نمایید...'
                    }
                } else {
                    mobileInput.classList.add('error')
                    btnPopup.nextElementSibling.textContent = 'مخاطب ابتدا باید در سامانه ثبت نام نماید!'
                }
            } else {
                mobileUser.classList.add('error')
                btnPopup.nextElementSibling.textContent = 'شماره موبایل معتبر نیست!'
            }
        })


    </script>
</body>
</html>